<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/bootstrap.min.css}">

    <title>My Break Screen</title>
</head>
<body id="body" style="background-color: #6699CC">
    <div class="container text-center" style="height: 25rem">
        <h1 class="text-light display-5" th:text="${message}"></h1>
        <label for="timeInput">Enter Time (HH:mm:ss):</label>
        <input type="text" id="timeInput">
        <button id="startButton">Start Timer</button>
        <input type="color" id="colorChoice" value="#6699CC">
    </div>
    <div>
        <h1 class="text-light display-1 container text-center" id="timerDisplay">Break Not Started</h1>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const timeInput = document.getElementById('timeInput');
            const startButton = document.getElementById('startButton');
            const timerDisplay = document.getElementById('timerDisplay');
            let timerInterval;
            let remainingTime;

            function updateDisplay() {
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Timer: Finished!";
                    return;
                }

                const hours = Math.floor(remainingTime / 3600);
                const minutes = Math.floor((remainingTime % 3600) / 60);
                const seconds = remainingTime % 60;

                const formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                timerDisplay.textContent = `On Break ${formattedTime}`;
                remainingTime--;
            }

            startButton.addEventListener('click', function() {
                const timeValue = timeInput.value;

                if (!timeValue) {
                    alert("Please enter a time.");
                    return;
                }

                const timeParts = timeValue.split(':');
                if (timeParts.length !== 3) {
                    alert("Please enter time in HH:mm:ss format");
                    return;
                }
                const hours = parseInt(timeParts[0], 10);
                const minutes = parseInt(timeParts[1], 10);
                const seconds = parseInt(timeParts[2], 10);

                if (isNaN(hours) || isNaN(minutes) || isNaN(seconds)) {
                    alert("Invalid time format. Please enter numbers.");
                    return;
                }

                remainingTime = hours * 3600 + minutes * 60 + seconds;

                if (remainingTime < 0) {
                    alert("Please enter a valid positive time.");
                    return;
                }

                clearInterval(timerInterval); // Clear any existing timer

                updateDisplay(); // update display immediately

                timerInterval = setInterval(updateDisplay, 1000);

            });
            colorChoice.addEventListener("input", updateFirst, false);
            colorChoice.addEventListener("change", watchColorPicker, false);
            function watchColorPicker(event) {
                document.getElementById("body").style.backgroundColor = event.target.value;
            }
        });
    </script>


    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>